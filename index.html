<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HumanStockLive - Gen Identity System</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js">// ğŸŒ DÃ¼nya gÃ¶rselini daha gerÃ§ekÃ§i yap ve Ã¼lke marker'Ä± ekle
const world = Globe()(document.getElementById('globe-container'))
  .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
  .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')
  .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')
  .pointOfView({ lat: 20, lng: 0, altitude: 2.2 })
  .showAtmosphere(true)
  .atmosphereColor('#3a228a')
  .atmosphereAltitude(0.25)
  .onGlobeReady(() => {
    world.controls().autoRotate = true;
    world.controls().autoRotateSpeed = 0.7;
  });

function addCountryMarker(lat, lng, label) {
  world
    .customLayerData([{ lat, lng, label }])
    .customThreeObject(d => {
      const sprite = new THREE.Sprite(
        new THREE.SpriteMaterial({ color: '#00ff00' })
      );
      sprite.scale.set(0.5, 0.5, 1);
      return sprite;
    })
    .customThreeObjectUpdate((obj, d) => {
      obj.position.setFromSphericalCoords(101, Math.PI / 2 - d.lat * Math.PI / 180, d.lng * Math.PI / 180);
      obj.__data = d;
    });
}

async function locateCountry(countryName) {
  try {
    const response = await fetch(`https://restcountries.com/v3.1/name/${countryName}`);
    const data = await response.json();
    const latlng = data[0].latlng;
    addCountryMarker(latlng[0], latlng[1], countryName);
  } catch (error) {
    console.error("Ãœlke koordinatlarÄ± alÄ±namadÄ±:", error);
  }
}
</script>
  <style>
    body {
      margin: 0;
      background-color: black;
      overflow-x: hidden;
      font-family: 'Courier New', Courier, monospace;
    }
    #terminal {
      padding: 20px;
      color: #00ff00;
      font-size: 16px;
    }
    #ai-insight {
      background-color: #111;
      color: #33ff33;
      padding: 20px;
      margin: 20px;
      border: 1px solid #0f0;
      font-family: 'Courier New', Courier, monospace;
    }
  </style>
</head>
<body>

<div id="globe-container"></div>

<div id="terminal">
  <h1>HumanStockLive // Gen Identity System</h1>

  <form id="userForm">
    <label>Name:</label><br>
    <input type="text" id="name" required><br><br>

    <label>Birth Date (YYYY-MM-DD):</label><br>
    <input type="date" id="birthDate" required><br><br>

    <label>Ethnicity:</label><br>
    <input type="text" id="ethnicity" required><br><br>

    <label>Country:</label><br>
    <input type="text" id="country" required><br><br>

    <button type="submit">Generate Identity</button>
  </form>

  <button id="downloadBtn">Download Certificate (PDF)</button>

  <pre id="output">â³ DÃ¼nya nÃ¼fusu verisi yÃ¼kleniyor...</pre>
</div>

<div id="popup">
  <div id="textArea"></div>
</div>

<div id="ai-insight">
  <h3>ğŸ§  Genetic AI Insight</h3>
  <p id="insight-text">Genetik potansiyeliniz analiz ediliyor...</p>
</div>

<div id="news-panel">
  <h2>ğŸŒ Global News</h2>
  <div id="news-content"></div>
</div>

<div id="science-panel">
  <h2>ğŸ§¬ Scientific Facts</h2>
  <div id="science-content">
    <p>- IÅŸÄ±k hÄ±zÄ±: 299.792.458 m/s</p>
    <p>- DNA molekÃ¼lÃ¼ 2 metre uzunluÄŸundadÄ±r.</p>
    <p>- GÃ¼neÅŸ sistemi 4.6 milyar yaÅŸÄ±ndadÄ±r.</p>
    <p>- Ä°nsan beyni 86 milyar nÃ¶ron iÃ§erir.</p>
    <p>- Evrende 2 trilyon galaksi olduÄŸu tahmin ediliyor.</p>
  </div>
</div>

<script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
<script src="https://unpkg.com/globe.gl"></script>

<script>
const lines = [
  "[GENETIC HUMAN ID CARD]",
  "- ID No: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
  "- Entry Time: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
  "- Adaptation Score: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ",
  "- Threat Level: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"
];

const textArea = document.getElementById('textArea');
let lineIndex = 0;
let charIndex = 0;

function typeLine() {
  if (lineIndex >= lines.length) return;

  const line = lines[lineIndex];
  if (charIndex < line.length) {
    textArea.innerHTML += line[charIndex];
    charIndex++;
    setTimeout(typeLine, 50);
  } else {
    textArea.innerHTML += "<br>";
    charIndex = 0;
    lineIndex++;
    setTimeout(typeLine, 300);
  }
}

window.onload = () => {
  setTimeout(typeLine, 500);
  startNotifications();
  startCrimeReminders();
  loadNews();

  fetch("http://localhost:3000/api/population")
    .then(res => res.text())
    .then(data => {
      const output = document.getElementById("output");
      const lines = data.split("\n");
      const rows = lines.slice(1).map(line => line.split(","));
      const latestRows = {};

      for (let i = 0; i < rows.length; i++) {
        const [countryName, countryCode, year, value] = rows[i];
        if (!latestRows[countryCode] || parseInt(year) > parseInt(latestRows[countryCode].year)) {
          latestRows[countryCode] = { countryName, year, value };
        }
      }

      const allCountries = Object.values(latestRows);
      const top5 = allCountries.sort((a, b) => b.value - a.value).slice(0, 5);

      output.innerText = "ğŸŒ The 5 most populous countries:\n\n" + top5.map(c =>
        `${c.countryName} (${c.year}): ${parseInt(c.value).toLocaleString()}`
      ).join("\n");
    })
    .catch(err => {
      const output = document.getElementById("output");
      output.innerText = "âŒ Veri alÄ±namadÄ±: " + err.message;
    });
};


  



document.getElementById("downloadBtn").addEventListener("click", () => {
  const name = document.getElementById("name").value;
  const birthDate = document.getElementById("birthDate").value;
  const ethnicity = document.getElementById("ethnicity").value;
  const country = document.getElementById("country").value;
  const insight = document.getElementById("insight-text").innerText;

  const pdf = new window.jspdf.jsPDF();
  pdf.setFont("courier");
  pdf.setTextColor(0, 255, 0);
  pdf.setFontSize(12);

  pdf.text("[GENETIC HUMAN ID CARD]", 20, 20);
  pdf.text(`Name: ${name}`, 20, 30);
  pdf.text(`Birth Date: ${birthDate}`, 20, 40);
  pdf.text(`Ethnicity: ${ethnicity}`, 20, 50);
  pdf.text(`Country: ${country}`, 20, 60);
  pdf.text(`Universal Entry ID: GEN-${Math.floor(Math.random() * 100000)}`, 20, 70);
  pdf.text("Global Status Snapshot:", 20, 90);
  pdf.text(document.getElementById("output").innerText, 20, 100);
  pdf.text("Genetic AI Insight:", 20, 130);
  pdf.text(insight, 20, 140);

  pdf.save("GenID_Certificate.pdf");
});
// ğŸ” GPT tabanlÄ± gerÃ§ek yapay zekÃ¢ sistemi
async function fetchAIInsight(inputText) {
  const response = await fetch("https://humanstocklive-1.onrender.com/api/gp", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ prompt: inputText })
  });

  const data = await response.json();
  const output = data.output;
  document.getElementById("insight-text").innerText = output;
}

// Form gÃ¶nderimi yapÄ±ldÄ±ÄŸÄ±nda GPT Ã§aÄŸrÄ±sÄ± yapÄ±lsÄ±n

// Mevcut submit event listener'Ä± iptal edildiÄŸi iÃ§in yeni listener:
document.getElementById("userForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const name = document.getElementById("name").value;
  const birthDate = document.getElementById("birthDate").value;
  const ethnicity = document.getElementById("ethnicity").value;
  const country = document.getElementById("country").value;

  const prompt = `AdÄ±: ${name}, DoÄŸum Tarihi: ${birthDate}, Etnik kÃ¶ken: ${ethnicity}, Ãœlke: ${country}. Bu kiÅŸiye ait genetik uyum, risk, potansiyel ve gÃ¼Ã§lÃ¼ yÃ¶nler hakkÄ±nda yorum yap.`;

  await fetchAIInsight(prompt);
  await locateCountry(country);
});
</script>
<script src="script.js"></script>
</body>
</html>
